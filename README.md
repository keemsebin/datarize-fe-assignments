# 김세빈 - Datarize Frontend 과제 전형

## 환경 변수 설정

프로젝트 실행을 위해 다음 환경 변수를 설정해야 합니다.

```env
VITE_API_ENDPOINT=http://localhost:4000/
```

`.env` 파일을 생성하거나 `apps/frontend/src/apis/fetcher.ts` 경로의 API_ENDPOINT를 VITE_API_ENDPOINT 값으로 변경해주셔야 합니다.

## 기술 스택 선택 이유

### ky, Tanstack-Query 사용

HTTP 요청은 ky를 사용해 공통 설정과 에러 처리를 중앙화했습니다. 특히 `afterResponse` 훅을 활용해 모든 API 응답을 가로채고, 백엔드 에러 메시지를 사용자 친화적인 메시지로 변환하여 각 API 호출부에서 개별적인 에러 분기 로직을 작성하지 않도록 했습니다. 이를 통해 네트워크 계층의 책임을 한 곳에 모으고, 클라이언트 코드에서는 성공 케이스에만 집중할 수 있었습니다.

서버 상태 관리는 TanStack Query를 사용해 로딩, 성공, 에러 상태를 선언적으로 관리했습니다. 일시적인 네트워크 오류에 대비해 retry 횟수를 3으로 설정하여 자동 재시도를 수행하고, `throwOnError: true` 옵션을 통해 에러를 throw하도록 구성했습니다. 이를 통해 복구 가능한 오류는 사용자에게 노출하지 않으면서, 실제로 처리 불가능한 에러만 ErrorBoundary에서 일괄적으로 처리할 수 있도록 설계했습니다.

### Rechart, Tailwind 선택 이유

가격대별 구매 빈도를 시각화하기 위해 React 생태계와 자연스럽게 통합되는 Recharts를 선택했습니다. Chart.js와 달리 JSX 기반의 선언적 API를 제공하여 컴포넌트 방식으로 차트를 구성할 수 있었습니다. 또한 반응형 처리가 내장되어 있어 별도의 설정 없이 다양한 화면 크기에 대응할 수 있었으며, TypeScript 지원이 우수해 타입 안정성을 확보하면서도 개발 속도를 유지할 수 있었습니다.

Tailwind CSS는 반응형, 상태별 스타일, 간격, 색상 등의 디자인 토큰이 유틸리티 클래스로 이미 정의되어 있어, 별도의 스타일 시트 작성 없이 빠르게 UI를 구성할 수 있다는 점에서 선택했습니다. 이를 통해 스타일 관리 비용을 줄이고 UI 구현과 기능 개발에 더 집중할 수 있었습니다.

## 에러 상태 처리

백엔드에서 반환하는 영문 에러 메시지를 사용자가 이해할 수 있는 한국어 메시지로 변환하는 계층화된 에러 처리 전략을 구현했습니다.

- 정확한 매칭: 백엔드 메시지를 키로 하는 맵핑 테이블(ERROR_MESSAGE_MAP)에서 정확히 일치하는 한국어 메시지를 반환합니다.
- 패턴 매칭: 동적 데이터를 포함한 메시지(예: "Product with ID 123")는 startsWith로 패턴을 감지하여 일반화된 메시지로 변환합니다.
- 원본 활용: 200자 이내의 이해 가능한 메시지는 불필요한 변환 없이 그대로 사용합니다.
- 상태 코드 폴백: HTTP 상태 코드(400, 404, 500 등)를 통해 일반적인 상황 메시지를 제공합니다.
- 최종 폴백: 모든 단계를 통과한 에러는 "알 수 없는 오류가 발생했습니다" 메시지를 표시합니다.

에러 메시지는 unknown 타입으로 받아 타입 가드를 통해 안전하게 처리하고, 변환된 메시지는 ApiError 클래스로 래핑해 ErrorBoundary로 전달했습니다. 이를 통해 사용자는 기술적인 에러 대신, 상황을 이해하기 쉬운 한국어 메시지를 확인하고 문제 상황을 명확히 인지할 수 있도록 했습니다.

## 공통 컴포넌트 구현, Storybook

Flex, Text 등 레이아웃과 타이포그래피를 추상화한 컴포넌트로 일관된 디자인 시스템을 구축했습니다. Storybook을 통해 컴포넌트를 격리된 환경에서 개발하고, JSDoc 주석으로 각 Props의 설명과 예시를 작성하여 팀원 간 협업을 용이하게 했습니다. Controls addon으로 실시간 Props 변경을 통해 다양한 상태를 빠르게 확인할 수 있습니다.
`yarn storybook` 명령어를 통해 확인 가능합니다.

> Storybook 설정 과정에서 Node version을 22로 설정했습니다.

## features 폴더 구조

도메인 중심의 폴더 구조를 채택하여 관련된 코드를 응집도 높게 구성했습니다. `Shopping` 도메인을 예로 들면 다음과 같이 구성됩니다.

```
features/Shopping/
├── api/              # 도메인별 API 쿼리 및 타입 정의
├── components/       # 도메인별 컴포넌트 (customers, purchase 등)
├── constants/        # 도메인별 상수 (차트 색상 등)
├── hooks/            # 도메인별 커스텀 훅 (useDateRange, useSearchCustomer 등)
└── utils/            # 도메인별 유틸리티 함수 (데이터 변환, 계산 등)
```

이 구조를 통해 각 도메인의 책임을 명확히 분리하고, 기능 추가나 수정 시 관련 파일을 쉽게 찾을 수 있습니다.

## 디바운싱을 통한 검색 최적화

고객 검색 기능에서 입력 값이 변경될 때마다 API 요청이 발생해, 빠른 타이핑 시 불필요한 요청이 연속적으로 발생하는 문제가 있었습니다. 이를 해결하기 위해 useDebounce 훅을 적용하여 사용자가 입력을 멈춘 후 500ms가 경과했을 때만 검색 API를 호출하도록 구현했습니다. 이를 통해 사용자 입력 흐름을 방해하지 않으면서도 불필요한 API 호출을 효과적으로 줄일 수 있었습니다.

## Yarn PnP 환경에서의 의존성 문제

Yarn PnP가 전역에서 활성화된 상태에서는 node_modules 디렉터리가 생성되지 않아 일부 도구가 정상적으로 동작하지 않았습니다. 따라서 yarn set version classic을 통해 Yarn을 Classic 모드로 전환한 후 yarn install을 다시 실행했고, 그 결과 Node Modules 기반 설정을 반영한 .yarnrc.yml 파일이 생성되었습니다.

## 요구 사항 체크리스트

### 가격대별 구매 빈도 차트

- [x] 한 달 동안 발생한 구매 데이터를 기준으로 가격대별 구매 빈도를 집계한다.
- [x] 가격대는 **2만원 이하부터 10만원 이상까지, 1만원 단위**로 구분한다.
- [x] 각 가격대별 구매 횟수를 계산한다.
- [x] 구매 빈도 데이터를 **바 차트 형태로 시각화**한다.
- [x] 날짜 선택 UI를 제공한다.
  - [x] 시작 날짜와 종료 날짜를 선택할 수 있다.
  - [x] 선택한 기간에 따라 차트 데이터가 갱신된다.

---

### 가장 많이 구매한 고객 목록 및 검색 기능

- [x] 최근 한 달 동안의 구매 데이터를 기준으로 고객별 구매 정보를 집계한다.
- [x] 고객 목록에 다음 정보를 표시한다.
  - [x] 고객 ID
  - [x] 고객 이름
  - [x] 총 구매 횟수
  - [x] 총 구매 금액
- [x] 기본 정렬 기준은 **고객 ID 오름차순**이다.
- [x] 정렬 옵션을 제공한다.
  - [x] 구매 횟수 기준 오름차순
  - [x] 구매 횟수 기준 내림차순
- [x] 고객 이름을 기준으로 검색할 수 있다.
  - [x] 검색어 입력 시 이름이 포함된 고객만 목록에 노출된다.

---

### 고객 ID 기반 상세 구매 내역 조회

- [x] 고객 목록에서 특정 고객 Row를 클릭할 수 있다.
- [x] 클릭 시 해당 고객의 상세 구매 내역을 조회한다.
- [x] 상세 구매 내역에는 다음 정보가 포함된다.
  - [x] 구매 날짜
  - [x] 구매한 제품 목록
  - [x] 각 제품의 가격
  - [x] 상품 썸네일 이미지
- [x] 조회된 상세 구매 내역은 고객 ID 기준으로 필터링된다.

## 정책서

쇼핑몰 구매 데이터 대시보드 애플리케이션

### 과제 개요

지원자님은 쇼핑몰의 구매 데이터를 시각화하고 분석할 수 있는 간단한 대시보드 애플리케이션을 개발하게 됩니다.  
이 애플리케이션은 `7월 한 달` 동안 발생한 구매 데이터를 기반으로 몇 가지 주요 정보를 제공해야 합니다.

**해당 프로젝트는 `node 20.13.1`, `yarn 1.22.22` 버전으로 세팅되었습니다**

**`apps/backend` 폴더 내의 코드는 임의로 수정하지 마세요**  
**문의 사항은 채널로 주시면 답변 드리겠습니다**

**제출 시에는 fork된 본인의 레포지토리 링크를 첨부하여 메일로 회신 주시면 확인하겠습니다 :) (원본 저장소에 PR 금지)**
**README 파일에 프로젝트 설정 및 실행 방법을 포함하세요.**

```cmd
cd apps
yarn install
yarn start-server
yarn start-client
```

### 요구 사항

- 가격대별 구매 빈도 차트

  - 한 달 동안 발생한 구매 데이터를 바탕으로, 각 가격대의 제품이 얼마나 많이 구매되었는지 보여주는 차트를 구현하세요. 가격대는 2만원 이하부터 10만원 이상까지 만원 단위로 구분됩니다. 차트는 바 차트 형태로 시각화되어야 합니다. 날짜를 선택해서 특정 기간을 조회할 수 있도록 구현해주세요.

- 가장 많이 구매한 고객 목록 및 검색 기능

  - 한 달 동안 가장 많이 구매한 고객을 내림차순/오름차순으로 정렬하여 보여주는 목록을 구현하세요. 기본 정렬은 ID입니다. 각 고객의 ID, 이름, 총 구매 횟수, 총 구매 금액을 표시하세요. 고객의 이름을 통해서 검색 가능해야 합니다.

- 고객 ID 기반 상세 기능

  - 특정 고객 Row를 클릭하면 해당 고객의 상세 구매 내역을 표시할 수 있는 기능을 구현하세요. 검색 결과에는 해당 고객의 구매 날짜, 구매한 제품 목록, 각 제품의 가격, 상품 썸네일이 포함되어야 합니다.
